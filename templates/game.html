{% extends "layout.html" %}

{% block main %}
<script>
    let answered = false;

    function mark_answers() {

        const correct_answer = "True";
        let div;
        var originalImg;
        var imgContainerDiv;
        let correct_title;

        {% for option in options %}
        var img = document.createElement("img");
        div = document.getElementById("{{ option["title"] | safe }}");

        if (correct_answer == "{{option["correct_answer"]}}") {
            correct_title = "{{option["title"] | safe}}";
            img.src = "/static/check.png";
        }
        else {
            img.src = "/static/delete.png";
        }

        imgContainerDiv = div.querySelector(".img-container");
        originalImg = imgContainerDiv.querySelector(".options");
        img.classList.add("img-check")
        imgContainerDiv.insertBefore(img, originalImg);

        {% endfor %}

        document.getElementById("questions").innerText = correct_title;
    }

    function check_answer(object) {
        if (answered) {
            return;
        }
        answered = true;

        {% for option in options %}
        {% if option["correct_answer"] %}
        let correct_image = "{{option["img"]}}";
        {% endif %}
        {% endfor %}

        if (object.src == correct_image) {
            console.log("correct answer")
            let score = document.getElementById("current_score").innerText;
            score = score.split(" ");
            score = score[score.length - 1];
            score = parseInt(score) + 1;
            text = "Score: " + score.toString();
            document.getElementById("current_score").innerText = text;

            if (score > {{bigger_score}}) {
                document.getElementById("biggest_score").innerText = "Biggest score: " + score.toString();
            }

            mark_answers();

            // right answer redirect 
            let title = document.getElementById("questions").innerText;

            /*
            const score_json = {
                currect_title: title,
                current_score: score,
                lose: false
            };
            */

            // countdown(2);
            setTimeout(function() {
                window.location.reload();
            }, 2000);
            // ===========================
        }
        else {
            console.log("wrong answer");
            mark_answers();
            // countdown(2);
            setTimeout(function() {
                window.location.href = "/gamemodes"
            }, 2000);
        }
    }
</script>

<div class="text-center" style="margin-top: 5%;">
    <h1 id="questions">???</h1>
    <audio controls id="song">
        <source src="{{song["preview"]}}" type="audio/mpeg">
    </audio>

    <script>
        const audio = document.getElementById("song");
        audio.volume = 0.15;
    </script>
</div>

<div class="d-flex justify-content-center gap-5" style="margin-top: 3%;">

    {% for option in options %}

    <div id="{{ option["title"] | safe }}" class="text-center">
        <div class="img-container">
            <img class="options rounded img-fluid d-inline-block me-2 shadow img-answer" src="{{option["img"]}}" onclick="check_answer(this)">
        </div>
        <p>{{ option["title"] }}</p> 
    </div>
    {% endfor %}
</div>

<div class="d-flex justify-content-center">
    <div class="rounded border border-dark p-3" style="max-width: 300px;">
        <p id="current_score">Score: {{score}}</p>
        <p id="biggest_score">Biggest score: {{bigger_score}}</p>
    </div>
</div>
{% endblock %}